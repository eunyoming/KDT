<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>

<!-- 부트스트랩 -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
	crossorigin="anonymous">
<!-- JQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"
	integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
	crossorigin="anonymous" type="text/javascript"></script>
<!-- 다음 우편번호 API -->
<script
	src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"
	type="text/javascript"></script>

<!-- css -->
<link rel="stylesheet" href="/resources/css/members/joinform.css">

</head>

<body>
	<form action="/members/insert" method="post">
		<div class="container">

			<div class="row join_header g-0">
				<div class="col-12 header_text pt-2 pb-2">회원 가입 정보 입력</div>
			</div>

			<div class="row g-0 mb-2">
				<div class="col-2 input_text pe-3 mb-2 mt-2">ID</div>
				<div class="col">
					<input type="text" class="mb-2 mt-2" placeholder="아이디를 입력하세요"
						id="id" name="id">
					<button type="button" class="btn" id="duplCheck">중복확인</button>
				</div>
			</div>

			<div class="row g-0 mb-2">
				<div class="col-2 mb-3 input_text pe-3">PW</div>
				<div class="col">
					<input type="password" placeholder="비밀번호를 입력하세요" class="input"
						id="pw" name="pw">
				</div>

			</div>

			<div class="row g-0 mb-2">
				<div class="col-2 mb-3 input_text pe-3">PW 확인</div>
				<div class="col">
					<input type="password" placeholder="비밀번호를 다시 입력하세요" class="input"
						id="pwCheck" name="pwCheck">
				</div>
			</div>

			<div class="row g-0 mb-2">
				<div class="col-2 mb-3 input_text pe-3">이름</div>
				<div class="col">
					<input type="text" placeholder="이름을 입력하세요." class="input" id="name"
						name="name">
				</div>
			</div>

			<div class="row g-0 mb-2">
				<div class="col-2 mb-3 input_text pe-3">전화번호</div>
				<div class="col">
					<input type="text" placeholder="전화번호를 입력하세요 (예: 010-1234-1234)"
						class="input" id="phone" name="phone">
				</div>
			</div>

			<div class="row g-0 mb-2">
				<div class="col-2 mb-3 input_text pe-3">이메일</div>
				<div class="col">
					<input type="text" placeholder="이메일을 입력하세요" class="input"
						id="email" name="email">
				</div>
			</div>

			<div class="row g-0 mb-2">
				<div class="col-2 mb-3 input_text pe-3">우편번호</div>
				<div class="col">
					<input type="text" placeholder="우편번호" class="input" id="postcode"
						name="zipcode"> <input type="button"
						onclick="sample4_execDaumPostcode()" value="찾기" class="btn">
				</div>
			</div>

			<div class="row g-0 mb-2">
				<div class="col-2 mb-3 input_text pe-3">주소</div>
				<div class="col">
					<input type="text" placeholder="주소를 입력하세요" class="input input_addr"
						id="roadAddress" name="address1">
				</div>
			</div>

			<div class="row g-0 mb-2">
				<div class="col-2 mb-3 input_text pe-3">상세주소</div>
				<div class="col">
					<input type="text" placeholder="상세주소를 입력하세요"
						class="input input_addr" id="detailAddress" name="address2">
				</div>
			</div>

			<div class="row g-0 mb-2">
				<div class="col join_footer">
					<button type="submit" class="btn" id="joinBtn">회원가입</button>
					<button type="reset" class="btn">다시입력</button>
				</div>
			</div>
		</div>
	</form>

	<script>
		// 다음 우편번호 API
		function sample4_execDaumPostcode() {
			new daum.Postcode({
				oncomplete : function(data) {
					// 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.
					// 우편번호와 주소 정보를 해당 필드에 넣는다.
					$("#postcode").val(data.zonecode);
					$("#roadAddress").val(data.roadAddress);
				}
			}).open();
		}

		// ID 중복체크 팝업창
		let isDuplCheck = false;
		
		// 아이디 입력 시 중복 체크 상태 초기화
	    $("#id").on("input", function () {
	        isDuplCheck = false;
	    });
		
		$("#duplCheck").on(
				"click",
				function() {
					$.ajax({
						url:"/members/idDuplCheck",
						data:{"id" : $("#id").val()}
					}).done(resp){
						if(!resp){
							alert("사용 가능한 아이디입니다.");
							isDuplCheck = true;
						}else{
							alert("중복된 아이디 입니다.");
							$("#id").val("").focus();
						}
					}
				})

		// (유효성 검사) 회원가입 버튼 클릭시
		$("form")
				.on(
						"submit",
						function() {
							// 중복 체크 여부 확인
						    if (!isDuplCheck) {
						        alert("아이디 중복 체크를 먼저 해주세요.");
						        $("#duplCheck").focus();
						        return false;
						    }
							
							// 정규식
							let regexId = /^[a-z0-9_]{4,12}$/;
							let regexPw = /^([a-zA-Z0-9]|[^a-zA-Z0-9\s]){8,16}$/;
							let regexName = /^[a-zA-Z가-힣]{2,6}$/;
							let regexPhone = /^010[0-9]{8}$|^010-[0-9]{4}-[0-9]{4}$/;
							let regexEmail = /^[\da-z_]{4,12}@[\w]+(\.com|\.co\.kr)$/;
							
							
							
							// ID
							let id = $("#id").val();

							if (id == '') {
								alert("아이디를 입력해주세요.");
								$("#id").focus();
								return false;
							}

							if (!regexId.test(id)) {
								alert("아이디 형식이 올바르지 않습니다.\n영어 소문자, 숫자, _만 가능 (4 ~ 12자)");
								$("#id").focus();
								return false;
							}

							// PW
							let pw = $("#pw").val();
							if (pw == "") {
								alert("패스워드를 입력해주세요.");
								$("#pw").focus();
								return false;
							}

							if (!regexPw.test(pw)) {
								alert("패스워드 형식이 올바르지 않습니다.\n영문, 숫자, 특수문자 각 한글자 이상 포함 ( 8 ~ 16자 )");
								$("#pw").focus();
								return false;
							}

							if (!(/[a-zA-Z]/.test(pw) && /[\d]/.test(pw) && /[^\w\s]/
									.test(pw))) {
								alert("영문, 숫자, 특수문자 각 한글자 이상 포함해야 됩니다. ( 8 ~ 16자 )");
								$("#pw").focus();
								return false;
							}

							// pw Check
							let pwCheck = $("#pwCheck").val();
							if (pwCheck == "") {
								alert("패스워드를 다시 확인해주세요.");
								$("#pwCheck").focus();
								return false;
							}

							if (pwCheck != pw) {
								alert("입력한 패스워드와 일치하지 않습니다.");
								$("#pwCheck").focus();
								return false;
							}

							// 이름
							let name = $("#name").val();
							if (name == "") {
								alert("이름을 입력해주세요.");
								$("#name").focus();
								return false;
							}

							if (!regexName.test(name)) {
								alert("이름 형식이 올바르지 않습니다.( 2 ~ 10자 )");
								$("#name").focus();
								return false;
							}

							// phone
							let phone = $("#phone").val();
							if (phone == "") {
								alert("전화번호를 입력해주세요.\n(예:01012341234 또는 010-1234-1234)");
								$("#phone").focus();
								return false;
							}

							if (!regexPhone.test(phone)) {
								alert("전화번호 형식이 맞지 않습니다.\n(예:01012341234 또는 010-1234-1234)");
								$("#phone").focus();
								return false;
							}

							// 이메일
							let email = $("#email").val();

							if (email != "") {
								if (!regexEmail.test(email)) {
									alert("이메일 형식이 올바르지 않습니다.\n예시 : 영문 및 숫자@naver.com\n예시2 : 영문 및 숫자@naver.co.kr");
									$("#email").focus();
									return false;
								}
							}
						})
	</script>
</body>
</html>