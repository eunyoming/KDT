package com.kedu.dao;

import java.util.Map;

import org.mybatis.spring.SqlSessionTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;

import com.kedu.dto.MembersDTO;

@Repository
public class MembersDAO {

	@Autowired
	private SqlSessionTemplate mybatis;

	// ID 중복검사
	public boolean isIdExist(String id) throws Exception{
		return mybatis.selectOne("Join.isIdExist", id);
	}

	// insert
	public int insert(MembersDTO dto) throws Exception{	
		return mybatis.insert("Join.insert", dto);
	}

	// login 성공여부
	public boolean checkLogin(Map<String, String> param) throws Exception{
		return mybatis.selectOne("Join.checkLogin", Integer.class, loginId, loginPw) > 0;
	}

	// 회원탈퇴
	public int deleteById(String id) throws Exception{
		String sql = "delete from members where id=?";

		return jdbc.update(sql, id);
	}

	// 회원정보 가져오기
	public MembersDTO getMemberById(String loginId) throws Exception{
		String sql = "select id, name, phone, email, zipcode, address1, address2, join_date from members where id = ?";

		return jdbc.queryForObject(sql, MembersDTO.class);
	}

	// 수정
	public int updateById(MembersDTO dto) throws Exception{
		String sql = "update members set phone=?, email=?, zipcode=?, address1=?, address2=? where id=?";

		return jdbc.update(sql, dto.getPhone(), dto.getEmail(), 
				dto.getZipcode(), dto.getAddress1(), 
				dto.getAddress2(), dto.getId());
	}

}
